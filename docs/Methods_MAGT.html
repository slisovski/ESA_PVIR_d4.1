<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Methods for quality assessment: MAGT</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">ESA_PVIR_d4.1</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="Methods_MAGT.html">Methods: MAGT</a>
</li>
<li>
  <a href="Results_MAGT.html">Results: MAGT</a>
</li>
<li>
  <a href="Methods_ALT.html">Methods: ALT</a>
</li>
<li>
  <a href="Results_ALT.html">Results: ALT</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Methods for quality assessment: MAGT</h1>

</div>


<style type="text/css">
.main-container {
  max-width: 1400px;
  margin-left: auto;
  margin-right: auto;
}
</style>
<details>
<summary>
R Library
</summary>
<pre class="r"><code>  library(readxl)
  library(ncdf4)
  library(raster)
  library(tidyverse)
  library(ggforce)
  library(grid)
  library(sf)
  sf::sf_use_s2(FALSE)</code></pre>
</details>
<p><br/></p>
<p>The in situ dataset:</p>
<details>
<summary>
Dataset compilation and crds match-up
</summary>
<pre class="r"><code>  ## correct coordinates from v2
  path    &lt;- &quot;/Users/slisovski/Documents/ESAproject/ValidationData/v2/20200813_MAGT_MATLAB_Style/&quot;
  metadat &lt;- read.table(glue::glue(&quot;{path}MAGT_meta.csv&quot;), sep = &quot;;&quot;, dec = &quot;.&quot;, header = TRUE) %&gt;% as_tibble()
  
  v2Dat &lt;- lapply(metadat$cci_ID, function(x) {
      metadat[metadat$cci_ID==x,] %&gt;%
        bind_cols(read.table(glue::glue(&quot;{path}MAGT_{x}.csv&quot;), sep = &quot;;&quot;, dec = &quot;.&quot;, header = TRUE) %&gt;% as_tibble()) %&gt;%
        rename(Year = X) %&gt;% pivot_longer(col = starts_with(&quot;X&quot;)) %&gt;% rename(Depth = name, Temp = value) %&gt;%
        filter(!is.na(Temp)) %&gt;% mutate(Depth = as.numeric(gsub(&quot;X&quot;, &quot;&quot;, Depth)), Simulation = NA)
      }) %&gt;% bind_rows() %&gt;% select(cci_ID, Name, Year, Latitude, Longitude) %&gt;%
      group_by(cci_ID, Name, Year) %&gt;% filter(row_number() == 1)
  
  
  ## GTD dataset
  inSitu_temp &lt;- read_excel(&quot;/Users/slisovski/Documents/ESAproject/ValidationData/20210218_focus_mean_yr_3.xlsx&quot;,
                          col_types = c(&quot;numeric&quot;, rep(&quot;text&quot;, 3), rep(&quot;numeric&quot;, 7), &quot;text&quot;, rep(&quot;numeric&quot;, 21), rep(&quot;text&quot;, 41))) %&gt;%
    select(c(&quot;cci_ID&quot;, &quot;Name&quot;, &quot;Source&quot;, &quot;Longitude&quot;, &quot;Latitude&quot;, &quot;Year&quot;, &quot;Depth&quot;), starts_with(&quot;X&quot;)) %&gt;%
    mutate(Source = if_else(Source%in%c(&quot;M. Ulrich&quot;, &quot;A. Kholodov&quot;, &quot;PANGAEA&quot;, &quot;Pangaea&quot;, &quot;Wangetal&quot;), &quot;GTN-P&quot;, Source)) %&gt;%
    mutate(Source = if_else(Source==&quot;GTN-P&quot;, &quot;GTN-P &amp; USGS&quot;, if_else(Source==&quot;Nordica&quot;, &quot;Nordicana-D&quot;, Source))) %&gt;%
    mutate(Source = if_else(Source==&quot;Above&quot;, &quot;NASA ABoVE&quot;, Source)) %&gt;%
    rowwise() %&gt;% mutate(coldSite = if(all(is.na(c_across(X0:X2000)))) NA else {ifelse(any(c_across(X0:X2000)&gt;1, na.rm = T), FALSE, TRUE)}) %&gt;%
    pivot_longer(col = starts_with(&quot;X&quot;)) %&gt;% rename(maxDepth = Depth, Depth = name, Temp = value) %&gt;% mutate(Depth = as.numeric(gsub(&quot;X&quot;, &quot;&quot;, Depth))) %&gt;%
    filter(!is.na(Temp)) %&gt;%
    left_join(v2Dat, by = c(&quot;cci_ID&quot;, &quot;Name&quot;, &quot;Year&quot;)) %&gt;%
    mutate(Latitude.y = if_else(is.na(Latitude.y), Latitude.x, Latitude.y), Longitude.y = if_else(is.na(Longitude.y), Longitude.x, Longitude.y)) %&gt;%
    rename(Longitude = Longitude.y, Latitude = Latitude.y) %&gt;%
    filter(!is.na(Latitude), !is.na(Latitude)) %&gt;% select(-Latitude.x, -Longitude.x)</code></pre>
</details>
<details>
<summary>
Figure 2.1 code
</summary>
<pre class="r"><code>  pl1 &lt;- ggplot(inSitu_temp, aes(x = Depth)) +
          geom_histogram(binwidth=25, position=&quot;dodge&quot;, col = &quot;grey20&quot;, fill = &quot;orange&quot;) +
          theme_bw() +
          theme(text = element_text(size=rel(4)))
  
  pl2 &lt;- ggplot(inSitu_temp, aes(x = Year)) +
          geom_histogram(binwidth=1, position=&quot;dodge&quot;, col = &quot;grey20&quot;, fill = &quot;lightsalmon&quot;) +
          theme_bw() +
          labs(y = &quot;&quot;) +
          theme(text = element_text(size=rel(4)))
  
  pl3 &lt;- ggplot(inSitu_temp, aes(x = Temp)) +
          geom_histogram(binwidth=1, position=&quot;dodge&quot;, col = &quot;grey20&quot;, fill = &quot;cornflowerblue&quot;) +
          theme_bw() +
          labs(y = &quot;&quot;) +
          theme(text = element_text(size=rel(4)))
  
  png(&quot;figures/Figure_2.1.png&quot;, width = 38, height = 9, units = &quot;cm&quot;, res = 250)
  gridExtra::grid.arrange(pl1, pl2, pl3, nrow = 1)
  dev.off()</code></pre>
</details>
<p><br/></p>
<p><img src="figures/Figure_2.1.png" /> <em>Figure 2.1: Sample size of complete in situ dataset of mean annual ground temperatures (MAGT) at discrete depths (left), for the years 1980 to 2019 (center), and across temperatures (right).</em></p>
<div id="pair-wise-match-up-evaluation" class="section level2">
<h2>Pair-wise Match-Up Evaluation</h2>
<p>We constructed a pixel-based pair-wise Permafrost_cci Match-up data collection based on</p>
<ol style="list-style-type: lower-roman">
<li>standardised in situ ground temperature (GT) data from 1997 to 2019 with a circum-Arctic geographic coverage, providing mean annual ground temperature (MAGT) in discrete measurement depths per year. This data collection is assembled as merged and newly standardised data from the community GT data archives across all permafrost zones (continuous, discontinuous, sporadic, and isolated). We also use the in situ MAGT time series for the binary evaluation of permafrost abundance.</li>
</ol>
<p>Reference in situ data sets for the Match-up evaluation are - in situ MAGT [Latitude, Longitude] in discrete depths in annual resolution from 1997 to 2019 - in situ PFR [Latitude, Longitude] permafrost probability in annual resolution from 1997 to 2019</p>
<ol start="2" style="list-style-type: lower-roman">
<li>standardised in situ active layer thickness (ALT) data from 1997 to 2019 with a circum-Arctic geographic coverage. We also use the ALT time series for a binary evaluation of permafrost abundance. This in situ data collection covers the continuous Permafrost zone.</li>
</ol>
<p>Reference in situ data sets for the Match-up evaluation are - in situ ALT [Latitude, Longitude] in annual resolution from 1997 to 20182019 - in situ PFR [Latitude, Longitude] permafrost probability in annual resolution from 1997 to 20182019</p>
<p>…</p>
</div>
<div id="assessment-of-permafrost-temperature" class="section level2">
<h2>Assessment of Permafrost Temperature</h2>
<div id="in-situ-ground-temperature-reference-data-generation" class="section level3">
<h3>In Situ Ground Temperature Reference Data Generation</h3>
<details>
<summary>
Match-up code
</summary>
<pre class="r"><code>  ## path with files from https://catalogue.ceda.ac.uk/uuid/b25d4a6174de4ac78000d034f500a268
  path    &lt;- &quot;/Users/slisovski/Documents/ESAproject/SimulationData/GroundTemperature/&quot;
  tempFls &lt;- data.frame(fl = list.files(path))
  tempFls$year &lt;- as.numeric(sapply(strsplit(tempFls$fl, &quot;-&quot;), function(x) x[7]))
  
  inSitu_temp$MAGT_Permafrost_cci  &lt;- NA
  
  for(y in unique(tempFls$year)) {
  
    cat(sprintf(&#39;\r%d&#39;, y))
  
    indTab &lt;- which(inSitu_temp$Year==y)
    subTab &lt;- st_as_sf(inSitu_temp[indTab,], coords = c(&quot;Longitude&quot;, &quot;Latitude&quot;), crs = 4326)
  
    st &lt;- stack(lapply(c(&quot;GST&quot;, &quot;T1m&quot;, &quot;T2m&quot;, &quot;T5m&quot;, &quot;T10m&quot;), function(x) {
      r0 &lt;- raster(glue::glue(&quot;{path}{tempFls$fl[tempFls$year==y]}&quot;), varname = x)
    }))
    proj4string(st) &lt;- &quot;+proj=stere +lat_0=90 +lat_ts=71 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs&quot;
  
    extrM &lt;- raster::extract(st, subTab %&gt;% st_transform(&quot;+proj=stere +lat_0=90 +lat_ts=71 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs&quot;) %&gt;%
                     st_coordinates())
  
    inSitu_temp$MAGT_Permafrost_cci[indTab] &lt;- apply(cbind(subTab$Depth/100, extrM), 1, function(x) {
      if(sum(!is.na(x[-1]))&gt;1) {
      Hmisc::approxExtrap(c(0, 1, 2, 5, 10), x[-1], x[1])$y
      } else NA
    })
  
  }
  save(inSitu_temp, file = &quot;data/inSitu_temp.rda&quot;)</code></pre>
</details>
<p><br/></p>
<p><em>Version 3 synthesised permafrost temperature at discrete depths</em> Permafrost_cci match-up in situ data in Phase 3 and Version 3 contains standardized annual ground temperatures (GTD) at various depths with a circum-Arctic coverage across 1997 to 2019. The mean annual GTD data at different discrete depths and time stamps was compiled from available national and international programs. Depths include 0, 0.2, 0.25, 0.4, 0.5, 0.6, 0.75, 0.8, 1.0, 1.2, 1.6, 2.0, 2.4, 2.5, 3.0, 3.2, 4.0, 5.0, 10.0, 15.0, 20.0 meter below ground.</p>
<p>Data sources:</p>
<ul>
<li><a href="https://gtnp.arcticportal.org/">Global Terrestrial Network for Permafrost GTN-P WMO/GCOS</a></li>
<li>Roshydromet RHM <a href="http://meteo.ru/data/164-soil-temperature">national monitoring programme, Russia</a><br />
</li>
<li>Nordicana-D <a href="http://www.cen.ulaval.ca/nordicanad/dpage.aspx?doi=45291SL34F28A9491014AFD;%20Allard%20et%20al.,%202016,%20CEN%202013">world data repository for Polar research, Canada</a>,</li>
<li>NASA ABoVE …</li>
</ul>
<details>
<summary>
Figure 2.2 code
</summary>
<pre class="r"><code>  ## base map
    mp &lt;-  st_read(&quot;~/Google Drive/GeoDat/NaturalEarth/50m_physical/ne_50m_land/ne_50m_land.shp&quot;, quiet = TRUE) %&gt;% 
    st_set_crs(4326) %&gt;% st_buffer(0) %&gt;% st_union() %&gt;%
    st_sym_difference(st_read(&quot;~/Google Drive/GeoDat/NaturalEarth/110m_physical/ne_110m_lakes/ne_110m_lakes.shp&quot;, quiet = TRUE) %&gt;% 
    st_set_crs(4326) %&gt;% st_union()) %&gt;%
    st_transform(&quot;+proj=stere +lat_0=90 +lat_ts=71 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs&quot;) %&gt;%
    st_crop(st_bbox(c(xmin = -5.5e6, ymin = -4e6, xmax = 8e6, ymax = 4e6)))
  
  map &lt;- ggplot() +
    geom_sf(data = mp, colour = NA, fill = &quot;slategray2&quot;) +
    theme_bw() +
    xlim(-5e6, 7.5e6) + ylim(-3.8e6, 3.8e6)
    
  # rast &lt;- raster(&quot;~/Documents/ESAproject/SimulationData/PermafrostExtent/ESACCI-PERMAFROST-L4-PFR-MODISLST_CRYOGRID-AREA4_PP-2018-fv03.0.nc&quot;)
  # rast_spdf &lt;- as(aggregate(rast, 15), &quot;SpatialPixelsDataFrame&quot;)
  # rast_df   &lt;- as.data.frame(rast_spdf)
  # colnames(rast_df) &lt;- c(&quot;value&quot;, &quot;x&quot;, &quot;y&quot;)
  # save(rast_df, file = &quot;Rmarkdown/temp/rast_df.rda&quot;)
  load(&quot;data/temp/rast_df.rda&quot;)
  
  mapDat &lt;- inSitu_temp %&gt;% group_by(Source) %&gt;% mutate(nSource = n()) %&gt;%
    filter(!duplicated(Name)) %&gt;% arrange(desc(nSource))
  
  crds_pts &lt;- st_as_sf(mapDat, coords = c(&quot;Longitude&quot;, &quot;Latitude&quot;)) %&gt;% st_set_crs(4326) %&gt;%
  st_transform(&quot;+proj=stere +lat_0=90 +lat_ts=71 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs&quot;) %&gt;% st_coordinates()
  
  png(&quot;figures/Figure_2.2.png&quot;, width = 38, height = 9, units = &quot;cm&quot;, res = 250)
  map +
    geom_raster(data=rast_df, aes(x=x, y=y, fill=value), alpha=0.8, size=0) + 
    scale_fill_gradient(low=&quot;slategray2&quot;, high=&quot;black&quot;) +
    labs(fill = &quot;Permafrost_cci PFR (2018)&quot;) +
    ggnewscale::new_scale_fill() +
    geom_point(data = data.frame(crds_pts, Source = mapDat$Source), 
               aes(x = X, y = Y, fill = Source), 
               color = &quot;black&quot;, size = 2.5, alpha = 1, stroke = 1, shape = 21) +
    scale_fill_brewer(palette = &quot;Set1&quot;) +
    labs(x = &quot;&quot;, y = &quot;&quot;) +
    labs(fill = &quot;Source of sites for GT Match-up&quot;)
  dev.off()</code></pre>
</details>
<p><img src="figures/Figure_2.2.png" /> <em>Figure 2.2. Northern hemisphere Permafrost_cci PFR permafrost probability and in situ ground temperature stations (grouped by data source).</em></p>
<details>
<summary>
Figure 2.3 code
</summary>
<pre class="r"><code>  template &lt;- expand_grid(Source = unique(inSitu_temp$Source), below10 = c(TRUE, FALSE), below10cold = c(TRUE, FALSE))
  
  bp &lt;- inSitu_temp %&gt;% mutate(Group = Depth&lt;1000) %&gt;% 
    group_by(Source, Group) %&gt;%
    summarize(n = n()) %&gt;% mutate(group = 2) %&gt;% filter(Group) %&gt;%
    bind_rows(inSitu_temp %&gt;% mutate(Group = Depth&lt;1000 &amp; coldSite) %&gt;% 
                group_by(Source, Group) %&gt;% summarize(n = n()) %&gt;% mutate(group = 1) %&gt;% filter(Group)) %&gt;%
    bind_rows(inSitu_temp %&gt;% mutate(Group = TRUE) %&gt;% 
                group_by(Source, Group) %&gt;%summarize(n = n()) %&gt;% mutate(group = 3) %&gt;% filter(Group)) %&gt;%
    arrange(Source, group) %&gt;% full_join(tibble(group = c(3,2,1), name = c(&quot;all&quot;, &quot;Depth &lt; 10m&quot;, &quot;Depth &lt; 10m &amp; MAGT &lt; 1°C&quot;)))
  
  png(&quot;figures/Figure_2.3.png&quot;, width = 38, height = 9, units = &quot;cm&quot;, res = 250)
  ggplot(bp, aes(y=Source, x=n, fill=as.factor(name))) +
            geom_bar(stat=&quot;identity&quot;, position = &quot;dodge&quot;, orientation = &quot;y&quot;, col = &quot;black&quot;) +
            scale_fill_manual(values = c(&quot;all&quot; = &quot;darkorange1&quot;, &quot;Depth &lt; 10m&quot; =  &quot;darkseagreen3&quot;, &quot;Depth &lt; 10m &amp; MAGT &lt; 1°C&quot; = &quot;dodgerblue2&quot;)) +
            theme_bw() +
            labs(x = &quot;count&quot;, y = &quot;&quot;) +
            labs(fill = &quot;Match-up dataset (1997-2019)&quot;) +
            theme(axis.title = element_text(size=rel(2)),
                  axis.text = element_text(size=rel(1.5)),
                  legend.text = element_text(size=rel(1.5)),
                  legend.title = element_text(size=rel(1.5)))
  dev.off()</code></pre>
</details>
<p><br/></p>
<p><img src="figures/Figure_2.3.png" /> <em>Figure 2.3. Sample size of in situ MAGT match up dataset grouped by data source.</em></p>
<details>
<summary>
Figure 2.4 code
</summary>
<pre class="r"><code>  mapDat &lt;- inSitu_temp %&gt;% filter(coldSite, !duplicated(Name))
  
  crds_pts &lt;- st_as_sf(mapDat, coords = c(&quot;Longitude&quot;, &quot;Latitude&quot;)) %&gt;% st_set_crs(4326) %&gt;%
  st_transform(&quot;+proj=stere +lat_0=90 +lat_ts=71 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs&quot;) %&gt;% st_coordinates()
  
  png(&quot;figures/Figure_2.4.png&quot;, width = 38, height = 9, units = &quot;cm&quot;, res = 250)
  map +
    geom_raster(data=rast_df, aes(x=x, y=y, fill=value), alpha=0.8, size=0, show.legend = TRUE) + 
    scale_fill_gradient(low=&quot;slategray2&quot;, high=&quot;black&quot;) +
    geom_point(data = data.frame(crds_pts), 
                 aes(x = X, y = Y), 
                 fill = &quot;cornflowerblue&quot;, size = 2.5, alpha = 1, shape = 21) +
    labs(x = &quot;&quot;, y = &quot;&quot;, title = &quot;&quot;, fill = &quot;Permafrost_cci PFR (2018)  &quot;) +
    theme(plot.title = element_text(size=15, hjust = 0.5)) +
    annotate(&quot;text&quot;, x = -4200000, y = 3700000, label= &quot;MAGT &lt;1°C&quot;, size = 3)
  dev.off()</code></pre>
<pre><code>  ## quartz_off_screen 
  ##                 2</code></pre>
</details>
<p><img src="figures/Figure_2.4.png" /> <em>Figure 2.4. Northern hemisphere Permafrost_cci PFR permafrost probability and in situ ground temperature stations with MAGT &lt;1 °C (right) and sites with measurement in depths &gt;=40 cm.</em></p>
<p>Mean Annual Ground Temperatures (MAGT) were used to calculate the annual mean temperature for each available depth using metadata information,allowing to assess the quality of each temperature measured temperature. Metadata include the ratio of missing data per month/year (missing days per year/365) and the amount of completely missing months. We did not calculate the annual mean for sites and depth that had &gt;20% missing values per year or if more than one complete month was missing. An exception was made for the data of GTN-P (2018) which already represented temperature at the depth of Zero Annual Amplitude (ZAA).</p>
<p><em>Table 2.1. Example of how the compiled data set provides the metadata information of yearly values. Mxx = ratio of missing values per month/year at depth xx m. mMxx = number of completely missing months per year at depth xx m.</em> <img src="figures/Table_2.1.png" /></p>
</div>
<div id="continous-updates-of-the-ground-temperature-match-up-data-sets" class="section level3">
<h3>Continous Updates of the Ground Temperature Match-up Data Sets</h3>
<p>The in situ dataset (<em>synthesised GT at discrete depths</em>) contains 14107 Match-up pairs in time and depth from 354 sites. The dataset includes a large group with MAGT &gt; 0°C from boreholes that were specifically samples aling the southern boundary of the <em>isolated permafrost</em> zone.</p>
<p><em>Exclusion of non-permafrost temperatures in GT Match-up Data Set v1 (Validation in phase 1, CRDPv0 2019)</em></p>
<p>For straightforward Match-up analyses in the first validation round [RD-7], we evaluated only permafrost temperature and not ground temperature in general. Therefore, we excluded all stations with in situ measurements of MAGT ≥1 °C at least once (independent of measurement depth) from the match-up analyses. This GTD Match-up dataset, with all ‘warm temperature’ station types excluded, contained only n = 3185 match-up pairs in time and depth. The new assessment (as detailed below) includes non-permafrost sites and considers more than 10.000 match-up pairs.</p>
<p><em>Inclusion of warm temperatures, exclusion of high mountain, mountain top and Yedoma boreholes in GT Match-up Data Set v2 (Validation in phase 2, CRDPv1 2020)</em></p>
<p>We conduct the second validation round in phase 2 using i) the GTD data collection with also the ‘non-permafrost’ ground temperature with MAGT ≥1 °C included (depths down to 10 m). This GTD Match-up data set for Permafrost_cci MAGT in 0, 0.2, 0.25, 0.4, 0.5, 0.6, 0.75, 0.8, 1.0, 1.2, 1.6, 2.0, 2.4, 2.5, 3.0, 3.2, 4.0, 5.0, 10.0 m depth included n = 13695 Match-up pairs in time and depth ii) the GTD data collection restricted to MAGT &lt;1 °C (depths down to 10 m) that included n = 3186 Match-up pairs in time and depth. As especially the Russian boreholes have only few measurements at exactly 1 or 2 m depth, we started interpolating temperature values for the Permafrost_cci focus depths. To achieve this, we only use sites with at least three sensors in the lower depth down to 1.20 m. Interpolation was conducted by linear regression between two single measurement depths, resulting in separate equations for each sensor-pair and year. Please note that we excluded all sites that are not representative of the landscape-scale of in-situ measurements from all three Match-up data collections: these are mountain sites (n = 18) that are specifically assessed by PERMOS, small-scale landscape anomalies such as very local peatland patches or in-situ measurements in pingos (ice hills, n = 3). Please also note that we excluded all sites within the Siberian Yedoma area (shape file from Bryant et al., 2017) due to incorrect parameterisation of Permafrost_cci CryoGrid-3 of Yedoma stratigraphy (n = 7).</p>
<p><em>GT Match-up Data Set v3 (Validation in phase 3, CRDPv2 2021)</em></p>
<p>We conduct the second validation round in phase 3 using</p>
<ol style="list-style-type: lower-roman">
<li>the GTD data collection with also the ‘non-permafrost’ ground temperature with MAGT ≥1 °C included (depths down to 10 m). This GTD Match-up data set for Permafrost_cci MAGT interpolated in 0, 0.2, 0.25, 0.4, 0.5, 0.6, 0.75, 0.8, 1.0, 1.2, 1.6, 2.0, 2.4, 2.5, 3.0, 3.2, 4.0, 5.0, 10.0 m depth includes n = <em>xx</em> Match-up pairs in time and depth We also conduct Match-up analyses with focus on permafrost temperature using</li>
<li>the GTD data collection restricted to MAGT &lt;1 °C (depths down to 10 m). This GTD Match-up data set includes n = <em>xx</em> Match-up pairs in time and depth for Permafrost_cci MAGT interpolated in 0, 0.2, 0.25, 0.4, 0.5, 0.6, 0.75, 0.8, 1.0, 1.2, 1.6, 2.0, 2.4, 2.5, 3.0, 3.2, 4.0, 5.0, 10.0 m depth and n = xx Match-up pairs in time and depth for Permafrost_cci MAGT in 0, 1, 2, 5, 10 m depth.</li>
</ol>
<p><em>v2 and v3 comparison</em></p>
<details>
<summary>
Version 2 data compilation
</summary>
<pre class="r"><code>  path    &lt;- &quot;/Users/slisovski/Documents/ESAproject/ValidationData/v2/20200813_MAGT_MATLAB_Style/&quot;
  metadat &lt;- read.table(glue::glue(&quot;{path}MAGT_meta.csv&quot;), sep = &quot;;&quot;, dec = &quot;.&quot;, header = TRUE) %&gt;% as_tibble()
  
  v2Dat &lt;- lapply(metadat$cci_ID, function(x) {
      metadat[metadat$cci_ID==x,] %&gt;%
        bind_cols(read.table(glue::glue(&quot;{path}MAGT_{x}.csv&quot;), sep = &quot;;&quot;, dec = &quot;.&quot;, header = TRUE) %&gt;% as_tibble()) %&gt;%
        rename(Year = X) %&gt;% pivot_longer(col = starts_with(&quot;X&quot;)) %&gt;% rename(Depth = name, Temp = value) %&gt;%
        filter(!is.na(Temp)) %&gt;% mutate(Depth = as.numeric(gsub(&quot;X&quot;, &quot;&quot;, Depth)), Simulation = NA)
      }) %&gt;% bind_rows()</code></pre>
</details>
<details>
<summary>
Version 2 match up
</summary>
<pre class="r"><code>  path    &lt;- &quot;/Users/slisovski/Documents/ESAproject/SimulationData/v2/GroundTemperature/&quot;
  tempFls &lt;- data.frame(fl = list.files(path))
  tempFls$year &lt;- as.numeric(sapply(strsplit(tempFls$fl, &quot;-&quot;), function(x) x[7]))  
  
  for(y in unique(v2Dat$Year[v2Dat$Year%in%tempFls$year])) {
  
    cat(sprintf(&#39;\r%d&#39;, y))
  
    indTab &lt;- which(v2Dat$Year==y)
    subTab &lt;- st_as_sf(v2Dat[indTab,], coords = c(&quot;Longitude&quot;, &quot;Latitude&quot;), crs = 4326)
  
    st &lt;- stack(lapply(c(&quot;GST&quot;, &quot;T1m&quot;, &quot;T2m&quot;, &quot;T5m&quot;, &quot;T10m&quot;), function(x) {
      r0 &lt;- raster(glue::glue(&quot;{path}{tempFls$fl[tempFls$year==y]}&quot;), varname = x)
    }))
    proj4string(st) &lt;- &quot;+proj=stere +lat_0=90 +lat_ts=71 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs&quot;
  
    extrM &lt;- raster::extract(st, subTab %&gt;% st_transform(&quot;+proj=stere +lat_0=90 +lat_ts=71 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs&quot;) %&gt;%
                     st_coordinates())
  
    v2Dat$Simulation[indTab] &lt;- apply(cbind(subTab$Depth/100, extrM), 1, function(x) {
      if(sum(!is.na(x[-1]))&gt;1) {
      Hmisc::approxExtrap(c(0, 1, 2, 5, 10), x[-1], x[1])$y
      } else NA
    })
    
  }
  save(v2Dat, file = &quot;data/v2Dat_matchup.rda&quot;)</code></pre>
</details>
<p><br/></p>
<details>
<summary>
Match up v2 and v3
</summary>
<pre class="r"><code>  merDat &lt;- v2Dat %&gt;% 
    select(cci_ID, Name, Source, Year, Depth, Simulation, Temp) %&gt;% 
    rename(MAGT_Permafrost_cci = Simulation) %&gt;%
    filter(Year %in% c(1997:2018)) %&gt;% full_join(inSitu_temp, by = c(&quot;cci_ID&quot;, &quot;Name&quot;, &quot;Source&quot;, &quot;Year&quot;, &quot;Depth&quot;))</code></pre>
</details>
<p><br/></p>
<details>
<summary>
Figure 2.4: code
</summary>
<pre class="r"><code>  f01a &lt;- ggplot(merDat) +
            geom_point(aes(x = Temp.x, y = Temp.y), size = 2.5, alpha = 0.25, shape = 16) +
            theme_bw() +
            labs(x = &quot;&quot;, y = &quot;&quot;, title = &quot;in situ MAGT&quot;) +
            theme(text = element_text(size=rel(4.5)),
                  plot.title = element_text(size=20))
            
  f01b &lt;-  ggplot(merDat) +
            geom_point(aes(x = MAGT_Permafrost_cci.x, y = MAGT_Permafrost_cci.y), size = 2.5, alpha = 0.25, shape = 16) +
            theme_bw() +
            labs(x = &quot;&quot;, y = &quot;&quot;, title = &quot;simulated MAGT&quot;) +
            theme(text = element_text(size=rel(4.5)),
                  plot.title = element_text(size=20))
  
  png(&quot;figures/Figure_2.7.png&quot;, width = 20, height = 10, units = &quot;cm&quot;, res = 100)
  gridExtra::grid.arrange(f01a, f01b, nrow = 1, bottom = textGrob(&quot;MAGT v2&quot;, gp=gpar(fontsize=20)), 
                          left = textGrob(&quot;MAGT v3&quot;, gp=gpar(fontsize=20), rot = 90))
  dev.off()</code></pre>
</details>
<p><img src="figures/Figure_2.7.png" /></p>
<p><em>Figure 2.7. Comparison between in situ (left) and Match-up (right) datasets of version 2 and version 3.</em></p>
<p>The MAGT is often based on several measurements across the year (or on min an max measurements). In v2.0 some calculations were false and are now corrected in v3.0.</p>
<details>
<summary>
Figure 2.8: code
</summary>
<pre class="r"><code>  subDat &lt;- merDat %&gt;% filter(!is.na(Temp.x)) %&gt;% rowwise() %&gt;% mutate(diffTemp = Temp.x - Temp.y) %&gt;% 
    filter(!is.na(diffTemp)) %&gt;%
    arrange(abs(diffTemp))
                              
  png(&quot;figures/Figure_2.8.png&quot;, width = 20, height = 10, units = &quot;cm&quot;, res = 100)
  ggplot(subDat, aes(x = diffTemp)) +
    geom_histogram(binwidth=.1, position=&quot;dodge&quot;) +
    scale_fill_manual(values = c(&quot;goldenrod2&quot;, &quot;cornflowerblue&quot;)) +
    xlim(-2.5, 2.5) +
    theme_bw() +
    labs(fill=&#39;&#39;, x = &quot;diff. in MAGT [°C] between v2.0 and v3.0&quot;, y = &quot;Count&quot;) +
    theme(text = element_text(size=rel(4)),
          legend.text = element_text(size=12)) +
    facet_zoom(ylim = c(0, 100))</code></pre>
<pre><code>  ## Warning: Removed 4 rows containing missing values (geom_bar).</code></pre>
<pre class="r"><code>  dev.off()</code></pre>
<pre><code>  ## quartz_off_screen 
  ##                 2</code></pre>
</details>
<p><img src="figures/Figure_2.8.png" /></p>
<p><em>Figure 2.8: The extent of temperature correction between v2.0 and v3.0. The vast majority of values where correct and only a couple of sites needed relatively small corrections.</em></p>
<p>The updated v3.0 contains new sites.</p>
<details>
<summary>
Figure 2.9: code
</summary>
<pre class="r"><code>  subDat &lt;- merDat %&gt;% filter(!is.na(Temp.y) &amp; is.na(Temp.x)) %&gt;%
    select(cci_ID, Name, Source, Year, Longitude, Latitude) %&gt;%
    group_by(Name) %&gt;% mutate(count = n()) %&gt;% filter(!duplicated(Name))
  
  crds_pts &lt;- st_as_sf(subDat, coords = c(&quot;Longitude&quot;, &quot;Latitude&quot;)) %&gt;% st_set_crs(4326) %&gt;%
      st_transform(&quot;+proj=stere +lat_0=90 +lat_ts=71 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs&quot;) %&gt;%
      st_coordinates()
  
   f04 &lt;- map +
          geom_point(data = data.frame(crds_pts, size = subDat$count), aes(x = X, y = Y, size = size), 
                     color = &quot;orange&quot;, alpha = 0.6, stroke = 1, shape = 16) +
          labs(size = &quot;Sample size&quot;) +
          labs(x = &quot;&quot;, y = &quot;&quot;)
   
    png(&quot;figures/Figure_2.9.png&quot;, width = 15, height = 10, units = &quot;cm&quot;, res = 100)
    f04
    dev.off()</code></pre>
<pre><code>  ## quartz_off_screen 
  ##                 2</code></pre>
</details>
<p><img src="figures/Figure_2.9.png" /></p>
<p><em>Figure 2.9: Location and sample size of new in situ sites included in <code>synthesised GT at discrete depths v3.0</code> dataset.</em></p>
</div>
<div id="characteristics-of-ground-temperature-match-up-data-set" class="section level3">
<h3>Characteristics of Ground Temperature Match-up Data Set</h3>
<p>…</p>
<details>
<summary>
Figure 2.10 code
</summary>
<pre class="r"><code>  subDat &lt;- inSitu_temp %&gt;% filter(Depth&lt;1000) %&gt;%
    pivot_longer(col = c(&quot;Temp&quot;, &quot;MAGT_Permafrost_cci&quot;)) %&gt;%
    mutate(name = if_else(name==&quot;Temp&quot;, &quot;in situ&quot;, &quot;permafrost_cci&quot;))
  
  png(&quot;figures/Figure_2.10.png&quot;, width = 22, height = 6, units = &quot;cm&quot;, res = 250)
  ggplot(subDat, aes(x = value, fill= name)) +
    geom_histogram(binwidth=1, position=&quot;dodge&quot;, aes(y=(..count../sum(..count..))*100)) +
    scale_fill_manual(values = c(&quot;cornflowerblue&quot;, &quot;goldenrod2&quot;)) +
    xlim(-14, 10) +
    theme_bw() +
    labs(fill=&#39;&#39;, x = &quot;MAGT [°C]&quot;, y = &quot;Percentage&quot;) +
    theme(text = element_text(size=rel(4)),
          legend.text = element_text(size=14))
  dev.off()  </code></pre>
<pre><code>  ## quartz_off_screen 
  ##                 2</code></pre>
</details>
<p><img src="figures/Figure_2.10.png" /> <em>Figure 2.10. Frequency distribution of the Match-up data collection v3, at all discrete depths ≤10 m in entire ranges with steps of 1 °C.</em></p>
<details>
<summary>
figure 2.11 code
</summary>
<pre class="r"><code>  subDat &lt;- inSitu_temp %&gt;% filter(Depth&lt;1000, !coldSite) %&gt;%
    pivot_longer(col = c(&quot;Temp&quot;, &quot;MAGT_Permafrost_cci&quot;)) %&gt;%
    mutate(name = if_else(name==&quot;Temp&quot;, &quot;in situ&quot;, &quot;permafrost_cci&quot;))
  
  png(&quot;figures/Figure_2.11.png&quot;, width = 22, height = 6, units = &quot;cm&quot;, res = 250)
  ggplot(subDat, aes(x = value, fill= name)) +
    geom_histogram(binwidth=1, position=&quot;dodge&quot;, aes(y=(..count../sum(..count..))*100)) +
    scale_fill_manual(values = c(&quot;cornflowerblue&quot;, &quot;goldenrod2&quot;)) +
    xlim(-14, 10) +
    theme_bw() +
    labs(fill=&#39;&#39;, x = &quot;MAGT [°C]&quot;, y = &quot;Percentage&quot;) +
    theme(text = element_text(size=rel(4)),
          legend.text = element_text(size=14))
  dev.off()  </code></pre>
<pre><code>  ## quartz_off_screen 
  ##                 2</code></pre>
</details>
<p><img src="figures/Figure_2.11.png" /> <em>Figure 2.11. Frequency distribution of the Match-up data collection v3, with MAGT ≥1 °C excluded (excluded samples = 9427). ….</em></p>
<details>
<summary>
Figure 2.12 code
</summary>
<pre class="r"><code>  subDat &lt;- inSitu_temp %&gt;% 
      pivot_longer(col = c(&quot;Temp&quot;, &quot;MAGT_Permafrost_cci&quot;)) %&gt;%
      mutate(name = if_else(name==&quot;Temp&quot;, &quot;in situ&quot;, &quot;permafrost_cci&quot;)) %&gt;%
      filter(Depth %in% c(75, 80, 100, 120, 200, 240))
  
  png(&quot;figures/Figure_2.12.png&quot;, width = 22, height = 20, units = &quot;cm&quot;, res = 250)
  ggplot(subDat, aes(x = value, fill= name)) +
     geom_histogram(binwidth=1, position=&quot;dodge&quot;, aes(y=(..count../sum(..count..))*100)) +
     facet_grid(Depth~.,scales=&quot;free&quot;) +
     scale_fill_manual(values = c(&quot;cornflowerblue&quot;, &quot;goldenrod2&quot;)) +
     xlim(-14, 10) +
     theme_bw() +
     labs(y = &quot;Percentage&quot;, fill = &quot;&quot;)</code></pre>
<pre><code>  ## Warning: Removed 12 rows containing missing values (geom_bar).</code></pre>
<pre class="r"><code>  dev.off()</code></pre>
<pre><code>  ## quartz_off_screen 
  ##                 2</code></pre>
</details>
<p><img src="figures/Figure_2.12.png" /></p>
<p><em>Figure 2.12. Frequency distribution of the Match-up data collection v3 confined to Match-up pairs in specific ground temperature sensor depths (0.75, 0.80, 100, 120, 200, 240 cm). ….</em></p>
</div>
<div id="permos-reference-gst-and-gtd-data-generation" class="section level3">
<h3>PERMOS Reference GST and GTD data generation</h3>
</div>
<div id="satellite-derived-freezethaw-surface-status-gt-evaluation-data-set-generation" class="section level3">
<h3>Satellite derived Freeze/Thaw Surface Status GT evaluation data set generation</h3>
</div>
</div>
<div id="assessment-of-active-layer-thickness" class="section level2">
<h2>Assessment of Active Layer Thickness</h2>
<div id="in-situ-active-layer-thickness-reference-data-generation" class="section level3">
<h3>In-Situ Active Layer Thickness Reference Data Generation</h3>
<details>
<summary>
ALT dataset compilation and cci matchup
</summary>
<pre class="r"><code>  inSitu_alt &lt;- read_excel(&quot;data/ALT_CALM+RAS_v2020.xlsx&quot;) %&gt;%
    mutate(ALT_Permafrost_cci = NA)
    
  path    &lt;- &quot;/Users/slisovski/Documents/ESAproject/SimulationData/ActiveLayerThickness/&quot;
  altFls  &lt;- data.frame(fl = list.files(path))
  altFls$year &lt;- as.numeric(sapply(strsplit(altFls$fl, &quot;-&quot;), function(x) x[7]))
  
  inSitu_alt &lt;- subset(inSitu_alt, year %in% altFls$year)
  
  for(y in unique(inSitu_alt$year)) {
  
    cat(sprintf(&#39;\r%d&#39;, y))
  
    indTab &lt;- which(inSitu_alt$year==y)
    subTab &lt;- st_as_sf(inSitu_alt[indTab,], coords = c(&quot;Longitude&quot;, &quot;Latitude&quot;), crs = 4326)
  
    st &lt;- raster(glue::glue(&quot;{path}{altFls$fl[altFls$year==y]}&quot;))
  
    extrM &lt;- extract(st, subTab %&gt;% st_transform(proj4string(st)) %&gt;%
                     st_coordinates())
  
    inSitu_alt$ALT_Permafrost_cci[indTab] &lt;- extrM
  }
  save(inSitu_alt, file = &quot;data/inSitu_alt.rda&quot;)</code></pre>
</details>
<p><br/></p>
<p>The comprehensive CALM data collection of ALT time series is available for download on <a href="https://www2.gwu.edu/~calm/" class="uri">https://www2.gwu.edu/~calm/</a>. For an estimation of ALT, it is relevant to measure active layer depths in the end of the active-layer thawing season. This maximum thaw depth measured in late summer represents the ALT of a specific year. For some measurements in the CALM ALT data collection, metadata information indicate that a value was measured earlier in summer during a year. These active layer depth measurements, not representing the Permafrost ECV ALT, were discarded.</p>
<p>Version 1 synthesised active layer thickness match-up collection (2003 to 2017) (2019) Permafrost_cci Match-up data set in phase 1, Version 1: standardised active layer thickness ALT data with annual resolution from 2003 and 2017 with a circum-Arctic geographic coverage. The collection contained data from 207 sites (China + Mongolia: 67, Greenland + Svalbard + Scandes: 11, Canada: 6, Russia: 57, USA: 207), with overall 1835 match-up pairs in time.</p>
<p>Version 2 synthesised active layer thickness match-up collection (1997 to 2018) (2020) Permafrost_cci Match-up data set in phase 2, Version 2: standardised active layer thickness ALT data with annual resolution from 1997 and 2018 with a circum-Arctic geographic coverage. The collection contains data from 156 sites with 1835 Match-up pairs. Please note that we excluded all sites in Mongolia, Central Asia, and on the Tibetan Plateau. Please also note that we excluded in the 2020 validation also all sites within the Siberian Yedoma area (Bryant et al., 2017) due to incorrect parameterisation of Permafrost_cci CryoGrid of Yedoma stratigraphy</p>
<p><em>Version 3</em> synthesised active layer thickness match-up collection (1997 to 2019) (2021) Permafrost_cci Match-up data set in phase 3, Version 3: standardised active layer thickness ALT data with annual resolution from 1997 and 2019 with a circum-Arctic geographic coverage. The collection contains data from <em>xx</em> sites with <em>xx</em> Match-up pairs. Please note that we excluded all sites in Mongolia, Central Asia, and on the Tibetan Plateau.</p>
<details>
<summary>
Figure 2.13 code
</summary>
<pre class="r"><code>  mapDat &lt;- inSitu_alt %&gt;% group_by(Name) %&gt;% mutate(nName = n()) %&gt;%
    filter(!duplicated(Name)) %&gt;% arrange(desc(nName))
  
  crds_pts &lt;- st_as_sf(mapDat, coords = c(&quot;Longitude&quot;, &quot;Latitude&quot;)) %&gt;% st_set_crs(4326) %&gt;%
  st_transform(&quot;+proj=stere +lat_0=90 +lat_ts=71 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs&quot;) %&gt;% st_coordinates()
  
  png(&quot;figures/Figure_2.13.png&quot;, width = 38, height = 9, units = &quot;cm&quot;, res = 250)
  map +
    geom_raster(data=rast_df, aes(x=x, y=y, fill=value), alpha=0.8, size=0, show.legend = TRUE) + 
    scale_fill_gradient(low=&quot;slategray2&quot;, high=&quot;black&quot;) +
    geom_point(data = data.frame(crds_pts), 
                 aes(x = X, y = Y), 
                 fill = &quot;gold1&quot;, size = 2.5, alpha = 1, shape = 21) +
    labs(x = &quot;&quot;, y = &quot;&quot;, title = &quot;&quot;, fill = &quot;Permafrost_cci PFR (2018)  &quot;) +
    theme(plot.title = element_text(size=15, hjust = 0.5))</code></pre>
<pre><code>  ## Warning: Ignoring unknown parameters: size</code></pre>
<pre><code>  ## Warning: Raster pixels are placed at uneven horizontal intervals and will be
  ## shifted. Consider using geom_tile() instead.</code></pre>
<pre><code>  ## Warning: Raster pixels are placed at uneven vertical intervals and will be
  ## shifted. Consider using geom_tile() instead.</code></pre>
<pre><code>  ## Warning: Removed 910 rows containing missing values (geom_raster).</code></pre>
<pre><code>  ## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<pre class="r"><code>  dev.off()</code></pre>
<pre><code>  ## quartz_off_screen 
  ##                 2</code></pre>
</details>
<p><img src="figures/Figure_2.13.png" /></p>
<p><em>Figure 2.13. Northern hemisphere Permafrost_cci PFR permafrost probability and in situ sites of active layer depth ALT (GTN-P CALM program).</em></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
